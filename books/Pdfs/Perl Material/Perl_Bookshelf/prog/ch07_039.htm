<HTML
><HEAD
>
<TITLE>[Chapter 7] 7.2.39 IPC::Open2&nbsp;- Open a Process for Both Reading and Writing</TITLE>
<META
NAME="DC.title"
CONTENT="Programming Perl"><META
NAME="DC.creator"
CONTENT="Larry Wall, Tom Christiansen &amp; Randal L. Schwartz"><META
NAME="DC.publisher"
CONTENT="O'Reilly &amp; Associates, Inc."><META
NAME="DC.date"
CONTENT="1999-07-02T02:02:46Z"><META
NAME="DC.type"
CONTENT="Text.Monograph"><META
NAME="DC.format"
CONTENT="text/html"
SCHEME="MIME"><META
NAME="DC.source"
CONTENT="1-56592-149-6"
SCHEME="ISBN"><META
NAME="DC.language"
CONTENT="en-US"><META
NAME="generator"
CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINK
REV="made"
HREF="mailto:online-books@oreilly.com"
TITLE="Online Books Comments"><LINK
REL="up"
HREF="ch07_02.htm"
TITLE="7.2 Library Modules"><LINK
REL="prev"
HREF="ch07_038.htm"
TITLE="7.2.38 integer&nbsp;- Do Arithmetic in Integer Instead of Double"><LINK
REL="next"
HREF="ch07_040.htm"
TITLE="7.2.40 IPC::Open3&nbsp;- Open a Process for Reading, Writing, and Error Handling"></HEAD
><BODY
BGCOLOR="#FFFFFF"
TEXT="#000000"
><DIV
CLASS="htmlnav"
><H1
><IMG
SRC="gifs/smbanner.gif"
ALT="Programming Perl"
USEMAP="#srchmap"
BORDER="0"></H1
><MAP
NAME="srchmap"
><AREA
SHAPE="RECT"
COORDS="0,0,466,65"
HREF="index.htm"
ALT="Programming Perl"><AREA
SHAPE="RECT"
COORDS="467,0,514,18"
HREF="../search/psrch.htm"
ALT="Search this book"></MAP
><TABLE
WIDTH="515"
BORDER="0"
CELLSPACING="0"
CELLPADDING="0"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="172"
><A
CLASS="SECT2"
HREF="ch07_038.htm"
TITLE="7.2.38 integer&nbsp;- Do Arithmetic in Integer Instead of Double"
><IMG
SRC="../gifs/txtpreva.gif"
ALT="Previous: 7.2.38 integer&nbsp;- Do Arithmetic in Integer Instead of Double"
BORDER="0"></A
></TD
><TD
ALIGN="CENTER"
VALIGN="TOP"
WIDTH="171"
><B
><FONT
FACE="ARIEL,HELVETICA,HELV,SANSERIF"
SIZE="-1"
><A
CLASS="chapter"
REL="up"
HREF="ch07_01.htm"
TITLE="7. The Standard Perl Library"
>Chapter 7<BR>The Standard Perl Library</A
></FONT
></B
></TD
><TD
ALIGN="RIGHT"
VALIGN="TOP"
WIDTH="172"
><A
CLASS="SECT2"
HREF="ch07_040.htm"
TITLE="7.2.40 IPC::Open3&nbsp;- Open a Process for Reading, Writing, and Error Handling"
><IMG
SRC="../gifs/txtnexta.gif"
ALT="Next: 7.2.40 IPC::Open3&nbsp;- Open a Process for Reading, Writing, and Error Handling"
BORDER="0"></A
></TD
></TR
></TABLE
>&nbsp;<HR
ALIGN="LEFT"
WIDTH="515"
TITLE="footer"></DIV
><DIV
CLASS="SECT2"
><H3
CLASS="sect2"
><A
CLASS="title"
NAME="AUTOID-23207"
>7.2.39 IPC::Open2&nbsp;- Open a Process for Both Reading and Writing</A
></H3
><PRE
CLASS="programlisting"
>use IPC::Open2;

# with named filehandles
$pid = open2(\*RDR, \*WTR, $cmd_with_args);
$pid = open2(\*RDR, \*WTR, $cmd, &quot;<CODE
CLASS="replaceable"
><I
>arg1</I
></CODE
>&quot;, &quot;<CODE
CLASS="replaceable"
><I
>arg2</I
></CODE
>&quot;, ...);</PRE
><PRE
CLASS="programlisting"
># with object-oriented handles
use FileHandle;
my($rdr, $wtr) = (FileHandle-&gt;new, FileHandle-&gt;new);
$pid = open2($rdr, $wtr, $cmd_with_args);</PRE
><P
CLASS="para"
><A
CLASS="indexterm"
NAME="CH07.OPEN21"
></A
><A
CLASS="indexterm"
NAME="CH07.OPEN22"
></A
><A
CLASS="indexterm"
NAME="CH07.OPEN23"
></A
><A
CLASS="indexterm"
NAME="CH07.OPEN24"
></A
><A
CLASS="indexterm"
NAME="CH07.OPEN25"
></A
>The <CODE
CLASS="literal"
>open2()</CODE
> function forks a child process to execute the
specified command.  The first two arguments represent filehandles, one
way or another.  They can be FileHandle objects, or they can be
references to typeglobs, which can either be explicitly named as above,
or generated by the Symbol package, as in the example below.  Whichever
you choose, they represent handles through which your program can read
from the command's standard output and write to the command's standard
input, respectively.  <CODE
CLASS="literal"
>open2()</CODE
> differs from Perl's built-in
<A
CLASS="xref"
HREF="ch03_102.htm"
TITLE="open"
><B
CLASS="xref.cmd"
>open</B
></A
> function in that it allows your program to communicate in
both directions with the child process.</P
><P
CLASS="para"
><CODE
CLASS="literal"
>open2()</CODE
> returns the process ID of the child process.  On failure it
reports a fatal error.</P
><P
CLASS="para"
>Here's a simple use of <CODE
CLASS="literal"
>open2()</CODE
> by which you can give the program
user interactive access to the <EM
CLASS="emphasis"
>bc</EM
>(1) command.  (<EM
CLASS="emphasis"
>bc</EM
> is an
arbitrary-precision arithmetic package.)  In this case we use the Symbol
module to produce &quot;anonymous&quot; symbols:</P
><PRE
CLASS="programlisting"
>use IPC::Open2;
use Symbol;

$WTR = gensym();  # get a reference to a typeglob
$RDR = gensym();  # and another one

$pid = open2($RDR, $WTR, 'bc');

while (&lt;STDIN&gt;) {            # read commands from user
     print $WTR $_;          # write a command to bc(1)
     $line = &lt;$RDR&gt;;         # read the output of bc(1)
     print STDOUT &quot;$line&quot;;   # send the output to the user
}</PRE
><P
CLASS="para"
><CODE
CLASS="literal"
>open2()</CODE
> establishes unbuffered output for <CODE
CLASS="literal"
>$WTR</CODE
>.  However,
it cannot control buffering of output from the designated command.
Therefore, be sure to heed the following warning.</P
><BLOCKQUOTE
CLASS="warning"
><P
CLASS="para"
><STRONG
>WARNING:</STRONG
> It is extremely easy for your program to hang while waiting
to read the next line of output from the command.  In the example just
shown, <EM
CLASS="emphasis"
>bc</EM
> is known to read and write one line at a time, so it is
safe.  But utilities like <EM
CLASS="emphasis"
>sort</EM
>(1) that read their entire input
stream before offering any output will cause a deadlock when used in the
manner we have illustrated.  You might do something like this instead:</P
><PRE
CLASS="programlisting"
>$pid = open2($RDR, $WTR, 'sort');

while (&lt;STDIN&gt;) {
     print $WTR $_;
}
close($WTR);    # finish sending all output to sort(1)

while (&lt;$RDR&gt;) {     # now read the output of sort(1)
     print STDOUT &quot;$_&quot;;
}</PRE
><P
CLASS="para"
>More generally, you may have to use <B
CLASS="emphasis.bold"
>select</B
> to determine which file
descriptors are ready to read, and then <A
CLASS="xref"
HREF="ch03_166.htm"
TITLE="sysread"
><B
CLASS="xref.cmd"
>sysread</B
></A
> for the actual
reading.</P
></BLOCKQUOTE
><DIV
CLASS="sect3"
><H4
CLASS="sect3"
><A
CLASS="title"
NAME="PERL2-CH-7-SECT-1.48"
>7.2.39.1 See also</A
></H4
><P
CLASS="para"
>The IPC::open3 module shows an alternative that handles <CODE
CLASS="literal"
>STDERR</CODE
>
as well.</P
><A
CLASS="indexterm"
NAME="AUTOID-23252"
></A
><A
CLASS="indexterm"
NAME="AUTOID-23253"
></A
><A
CLASS="indexterm"
NAME="AUTOID-23254"
></A
><A
CLASS="indexterm"
NAME="AUTOID-23255"
></A
><A
CLASS="indexterm"
NAME="AUTOID-23256"
></A
></DIV
></DIV
><DIV
CLASS="htmlnav"
><P
></P
><HR
ALIGN="LEFT"
WIDTH="515"
TITLE="footer"><TABLE
WIDTH="515"
BORDER="0"
CELLSPACING="0"
CELLPADDING="0"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="172"
><A
CLASS="SECT2"
HREF="ch07_038.htm"
TITLE="7.2.38 integer&nbsp;- Do Arithmetic in Integer Instead of Double"
><IMG
SRC="../gifs/txtpreva.gif"
ALT="Previous: 7.2.38 integer&nbsp;- Do Arithmetic in Integer Instead of Double"
BORDER="0"></A
></TD
><TD
ALIGN="CENTER"
VALIGN="TOP"
WIDTH="171"
><A
CLASS="book"
HREF="index.htm"
TITLE="Programming Perl"
><IMG
SRC="../gifs/txthome.gif"
ALT="Programming Perl"
BORDER="0"></A
></TD
><TD
ALIGN="RIGHT"
VALIGN="TOP"
WIDTH="172"
><A
CLASS="SECT2"
HREF="ch07_040.htm"
TITLE="7.2.40 IPC::Open3&nbsp;- Open a Process for Reading, Writing, and Error Handling"
><IMG
SRC="../gifs/txtnexta.gif"
ALT="Next: 7.2.40 IPC::Open3&nbsp;- Open a Process for Reading, Writing, and Error Handling"
BORDER="0"></A
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="172"
>7.2.38 integer&nbsp;- Do Arithmetic in Integer Instead of Double</TD
><TD
ALIGN="CENTER"
VALIGN="TOP"
WIDTH="171"
><A
CLASS="index"
HREF="index/idx_0.htm"
TITLE="Book Index"
><IMG
SRC="../gifs/index.gif"
ALT="Book Index"
BORDER="0"></A
></TD
><TD
ALIGN="RIGHT"
VALIGN="TOP"
WIDTH="172"
>7.2.40 IPC::Open3&nbsp;- Open a Process for Reading, Writing, and Error Handling</TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="515"
TITLE="footer"><P
CLASS="nav"
><FONT
SIZE="-1"
>[ <A
HREF="../index.htm"
TITLE="The Perl CD Bookshelf"
>Library Home</A
> | <A
HREF="../perlnut/index.htm"
TITLE="Perl in a Nutshell"
>Perl in a Nutshell</A
> | <A
HREF="../learn/index.htm"
TITLE="Learning Perl"
>Learning Perl</A
> | <A
HREF="../learn32/index.htm"
TITLE="Learning Perl on Win32 Systems"
>Learning Perl on Win32</A
> | <A
HREF="index.htm"
TITLE="Programming Perl"
>Programming Perl</A
> | <A
HREF="../advprog/index.htm"
TITLE="Advanced Perl Programming"
>Advanced Perl Programming</A
> | <A
HREF="../cookbook/index.htm"
TITLE="Perl Cookbook"
>Perl Cookbook</A
> ]</FONT
></P
></DIV
></BODY
></HTML
>
