<HTML
><HEAD
>
<TITLE>[Chapter 14] Process Management</TITLE>
<META
NAME="DC.title"
CONTENT="Learning Perl on Win32 Systems"><META
NAME="DC.creator"
CONTENT="Randal L. Schwartz, Erik Olson &amp; Tom Christiansen"><META
NAME="DC.publisher"
CONTENT="O'Reilly &amp; Associates, Inc."><META
NAME="DC.date"
CONTENT="1999-07-02T01:35:41Z"><META
NAME="DC.type"
CONTENT="Text.Monograph"><META
NAME="DC.format"
CONTENT="text/html"
SCHEME="MIME"><META
NAME="DC.source"
CONTENT="1-56592-324-3"
SCHEME="ISBN"><META
NAME="DC.language"
CONTENT="en-US"><META
NAME="generator"
CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINK
REV="made"
HREF="mailto:online-books@oreilly.com"
TITLE="Online Books Comments"><LINK
REL="up"
HREF="index.htm"
TITLE="Learning Perl on Win32 Systems"><LINK
REL="prev"
HREF="ch13_06.htm"
TITLE="13.6 Exercises"><LINK
REL="next"
HREF="ch14_02.htm"
TITLE="14.2 Using Backquotes"></HEAD
><BODY
BGCOLOR="#FFFFFF"
TEXT="#000000"
><DIV
CLASS="htmlnav"
><H1
><IMG
SRC="gifs/smbanner.gif"
ALT="Learning Perl on Win32 Systems"
USEMAP="#srchmap"
BORDER="0"></H1
><MAP
NAME="srchmap"
><AREA
SHAPE="RECT"
COORDS="0,0,466,54"
HREF="index.htm"
ALT="Learning Perl on Win32 Systems"><AREA
SHAPE="RECT"
COORDS="467,0,514,18"
HREF="../search/wsrch.htm"
ALT="Search this book"></MAP
><TABLE
WIDTH="515"
BORDER="0"
CELLSPACING="0"
CELLPADDING="0"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="172"
><A
CLASS="sect1"
HREF="ch13_06.htm"
TITLE="13.6 Exercises"
><IMG
SRC="../gifs/txtpreva.gif"
ALT="Previous: 13.6 Exercises"
BORDER="0"></A
></TD
><TD
ALIGN="CENTER"
VALIGN="TOP"
WIDTH="171"
><B
><FONT
FACE="ARIEL,HELVETICA,HELV,SANSERIF"
SIZE="-1"
>Chapter 14</FONT
></B
></TD
><TD
ALIGN="RIGHT"
VALIGN="TOP"
WIDTH="172"
><A
CLASS="sect1"
HREF="ch14_02.htm"
TITLE="14.2 Using Backquotes"
><IMG
SRC="../gifs/txtnexta.gif"
ALT="Next: 14.2 Using Backquotes"
BORDER="0"></A
></TD
></TR
></TABLE
>&nbsp;<HR
ALIGN="LEFT"
WIDTH="515"
TITLE="footer"></DIV
><DIV
CLASS="chapter"
><H1
CLASS="chapter"
><A
CLASS="title"
NAME="ch14-40824"
>14. Process Management</A
></H1
><DIV
CLASS="htmltoc"
><P
><B
>Contents:</B
><BR><A
CLASS="sect1"
HREF="#ch14-23962"
TITLE="14.1 Using system and exec"
>Using system and exec</A
><BR><A
CLASS="sect1"
HREF="ch14_02.htm"
TITLE="14.2 Using Backquotes"
>Using Backquotes</A
><BR><A
CLASS="sect1"
HREF="ch14_03.htm"
TITLE="14.3 Using Processes as Filehandles"
>Using Processes as Filehandles</A
><BR><A
CLASS="sect1"
HREF="ch14_04.htm"
TITLE="14.4 Summary of Process Operations"
>Summary of Process Operations</A
><BR><A
CLASS="sect1"
HREF="ch14_05.htm"
TITLE="14.5 Win32::Process"
>Win32::Process</A
><BR><A
CLASS="sect1"
HREF="ch14_06.htm"
TITLE="14.6 Exercises"
>Exercises</A
></P
><P
></P
></DIV
><DIV
CLASS="sect1"
><H2
CLASS="sect1"
><A
CLASS="title"
NAME="ch14-23962"
>14.1 Using system and exec</A
></H2
><P
CLASS="para"
>Like the command shell, a Perl program can <A
CLASS="indexterm"
NAME="ch14-idx-744310-0"
></A
><A
CLASS="indexterm"
NAME="ch14-idx-744310-1"
></A
>launch new processes, and like most other operations, has more than one way to do so.</P
><P
CLASS="para"
>The simplest way to launch a new process is to use the <A
CLASS="indexterm"
NAME="ch14-idx-744311-0"
></A
><CODE
CLASS="literal"
>system</CODE
> function. In its simplest form, this function hands a single string to a brand new command shell to be executed as a command. When the command is finished, the <CODE
CLASS="literal"
>system</CODE
> function returns the exit value of the command (typically <CODE
CLASS="literal"
>0</CODE
> if everything went OK). Here's an example of a Perl program executing a <EM
CLASS="emphasis"
>dir</EM
> command using a shell:</P
><PRE
CLASS="programlisting"
>system(&quot;dir&quot;);</PRE
><P
CLASS="para"
>We're ignoring the return value here, but the <EM
CLASS="emphasis"
>dir</EM
> command is not likely to fail anyway.</P
><P
CLASS="para"
>Where does the command's output go? In fact, where does the input come from, if it was a command that wanted input? These are good questions, and the answers to these questions are most of what distinguishes the various forms of process creation.</P
><P
CLASS="para"
>For the <CODE
CLASS="literal"
>system</CODE
> function, the three standard files (standard input, standard output, and standard error) are inherited from the Perl process. So, for the <EM
CLASS="emphasis"
>dir</EM
> command in the previous example, the output goes wherever the <CODE
CLASS="literal"
>print</CODE
> <CODE
CLASS="literal"
>STDOUT</CODE
> output goes&nbsp;- probably to the invoker's command prompt. Because you are firing off another command shell, you can change the location of the standard output using the normal<EM
CLASS="emphasis"
> </EM
>I/O redirections. For example, to put the output of the <EM
CLASS="emphasis"
>directory </EM
>command into a file named <EM
CLASS="emphasis"
>this_dir</EM
>, something like this will work just fine:</P
><PRE
CLASS="programlisting"
>system(&quot;dir &gt;this_dir&quot;) &amp;&amp; die &quot;cannot create this_dir&quot;;</PRE
><P
CLASS="para"
>This time, we not only send the output of the <EM
CLASS="emphasis"
>dir</EM
> command into a file with a redirection to the new command shell, but also check the return status. If the <A
CLASS="indexterm"
NAME="ch14-idx-744313-0"
></A
>return status is true (nonzero), something went wrong with the shell command, and the <CODE
CLASS="literal"
>die</CODE
> function will do its deed. This is backwards from normal Perl operator convention&nbsp;- a nonzero return value from the <CODE
CLASS="literal"
>system</CODE
> operator generally indicates that something went wrong. You can feed anything to the <CODE
CLASS="literal"
>system</CODE
> function that you can feed to your command shell.</P
><P
CLASS="para"
>Here's an example of generating a <EM
CLASS="emphasis"
>dir</EM
> command and sending the output to a filename specified by a Perl variable:</P
><PRE
CLASS="programlisting"
>$where = &quot;dir_out.&quot;.<A
CLASS="indexterm"
NAME="ch14-idx-744374-0"
></A
>++$i; # get a new filename
system &quot;dir &gt;$where&quot;;</PRE
><P
CLASS="para"
>The double-quoted string is <A
CLASS="indexterm"
NAME="ch14-idx-745086-0"
></A
>variable interpolated, so Perl replaces <CODE
CLASS="literal"
>$where</CODE
> with its value. </P
><P
CLASS="para"
>In addition to the standard filehandles, the current directory and the environment variables are inherited by the child. These variables are typically created by the command shell <EM
CLASS="emphasis"
>set</EM
> command and accessed or altered using the <EM
CLASS="emphasis"
>%KEYNAME%</EM
> construct. Environment variables are used by many utilities, including the command shell itself, to alter or control the way that utility operates.</P
><P
CLASS="para"
>Perl gives you a way to examine and alter current <A
CLASS="indexterm"
NAME="ch14-idx-744323-0"
></A
>environment variables through a special hash called <A
CLASS="indexterm"
NAME="ch14-idx-744322-0"
></A
><CODE
CLASS="literal"
>%ENV</CODE
> (uppercase). Each key of this hash corresponds to the name of an environment variable, with the corresponding value being, well, the corresponding value. Examining this hash shows you the environment handed to Perl by the parent process&nbsp;- altering the array affects the environment used by Perl and by its children processes, but not that of its parents.</P
><P
CLASS="para"
>For example, here's a simple program that prints out all of your environment variables:</P
><PRE
CLASS="programlisting"
>foreach $key (sort keys %ENV) {
        print &quot;$key=$ENV{$key}\n&quot;;
}</PRE
><P
CLASS="para"
>Note that the equal sign here is not an assigment, but simply a text character that the <CODE
CLASS="literal"
>print</CODE
> function is using to say stuff like <CODE
CLASS="literal"
>USERNAME=eriko</CODE
> or <CODE
CLASS="literal"
>COMSPEC=c:\nt\system32\cmd.exe</CODE
>.</P
><P
CLASS="para"
>Here's a program snippet that alters the value of <A
CLASS="indexterm"
NAME="ch14-idx-744325-0"
></A
><CODE
CLASS="literal"
>PATH</CODE
> to make sure that the <EM
CLASS="emphasis"
>nmake </EM
>command run by <A
CLASS="indexterm"
NAME="ch14-idx-744327-0"
></A
><CODE
CLASS="literal"
>system</CODE
> is looked for only in the correct places:</P
><PRE
CLASS="programlisting"
>$oldPATH = $ENV{&quot;PATH&quot;};            # save previous path
$ENV{&quot;PATH&quot;} = &quot;c:\\msdev\\bin;c:\\winnt;c:\\winnt\\system32&quot;; 
                                    # force known path
system(&quot;nmake myproj.mak &gt;output&quot;); # run command
$ENV{&quot;PATH&quot;} = $oldPATH;            # restore previous path</PRE
><P
CLASS="para"
>That's a lot of typing. It'd be faster just to set a local value for this hash element.</P
><P
CLASS="para"
>Despite its other shortcomings, the <CODE
CLASS="literal"
>local</CODE
> operator can do one thing that <CODE
CLASS="literal"
>my</CODE
> cannot: it can give just one element of an array or a hash a temporary value. For example:</P
><PRE
CLASS="programlisting"
>{
    local $ENV{&quot;PATH&quot;} = 
    &quot;c:\\msdev\\bin;c:\\winnt;c:\\winnt\\system32&quot;;
    system(&quot;nmake fred bedrock &gt;output&quot;);
}</PRE
><P
CLASS="para"
>The <A
CLASS="indexterm"
NAME="ch14-idx-745153-0"
></A
><CODE
CLASS="literal"
>system</CODE
> function can also take a list of arguments rather than a single argument. In this case, rather than handing the list of arguments off to a <A
CLASS="indexterm"
NAME="ch14-idx-745155-0"
></A
>command shell, Perl treats the first argument as the command to run (located according to the <CODE
CLASS="literal"
>PATH</CODE
> if necessary) and the remaining arguments as arguments to the command <EM
CLASS="emphasis"
>without</EM
> normal shell interpretation. In other words, you don't need to quote whitespace or worry about arguments that contain angle brackets because those are all merely characters to hand to the program. So, the following two commands are equivalent:</P
><PRE
CLASS="programlisting"
>system &quot;nmake 'fred flintstone.mak' buffaloes&quot;;   # using command shell
system &quot;nmake&quot;,&quot;fred flintstone.mak&quot;,&quot;buffaloes&quot;; # using list</PRE
><P
CLASS="para"
>Giving <CODE
CLASS="literal"
>system</CODE
> a list rather than giving it a simple string saves one command shell process as well, so do this when you can. (In fact, when the one-argument form of <CODE
CLASS="literal"
>system</CODE
> is simple enough, Perl itself optimizes away the shell invocation entirely, calling the resulting program directly as if you had used the multiple-argument invocation.)</P
><P
CLASS="para"
>Here's another example of equivalent forms:</P
><PRE
CLASS="programlisting"
>@cfiles = (&quot;fred.c&quot;,&quot;barney.c&quot;);           # what to compile
@options = (&quot;-DHARD&quot;,&quot;-DGRANITE&quot;);         # options
system &quot;cc -o slate @options @cfiles&quot;;     # using shell
system &quot;cc&quot;,&quot;-o&quot;,&quot;slate&quot;,@options,@cfiles; # avoiding shell</PRE
></DIV
></DIV
><DIV
CLASS="htmlnav"
><P
></P
><HR
ALIGN="LEFT"
WIDTH="515"
TITLE="footer"><TABLE
WIDTH="515"
BORDER="0"
CELLSPACING="0"
CELLPADDING="0"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="172"
><A
CLASS="sect1"
HREF="ch13_06.htm"
TITLE="13.6 Exercises"
><IMG
SRC="../gifs/txtpreva.gif"
ALT="Previous: 13.6 Exercises"
BORDER="0"></A
></TD
><TD
ALIGN="CENTER"
VALIGN="TOP"
WIDTH="171"
><A
CLASS="book"
HREF="index.htm"
TITLE="Learning Perl on Win32 Systems"
><IMG
SRC="../gifs/txthome.gif"
ALT="Learning Perl on Win32 Systems"
BORDER="0"></A
></TD
><TD
ALIGN="RIGHT"
VALIGN="TOP"
WIDTH="172"
><A
CLASS="sect1"
HREF="ch14_02.htm"
TITLE="14.2 Using Backquotes"
><IMG
SRC="../gifs/txtnexta.gif"
ALT="Next: 14.2 Using Backquotes"
BORDER="0"></A
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="172"
>13.6 Exercises</TD
><TD
ALIGN="CENTER"
VALIGN="TOP"
WIDTH="171"
><A
CLASS="index"
HREF="index/idx_0.htm"
TITLE="Book Index"
><IMG
SRC="../gifs/index.gif"
ALT="Book Index"
BORDER="0"></A
></TD
><TD
ALIGN="RIGHT"
VALIGN="TOP"
WIDTH="172"
>14.2 Using Backquotes</TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="515"
TITLE="footer"><P
CLASS="nav"
><FONT
SIZE="-1"
>[ <A
HREF="../index.htm"
TITLE="The Perl CD Bookshelf"
>Library Home</A
> | <A
HREF="../perlnut/index.htm"
TITLE="Perl in a Nutshell"
>Perl in a Nutshell</A
> | <A
HREF="../learn/index.htm"
TITLE="Learning Perl"
>Learning Perl</A
> | <A
HREF="index.htm"
TITLE="Learning Perl on Win32 Systems"
>Learning Perl on Win32</A
> | <A
HREF="../prog/index.htm"
TITLE="Programming Perl"
>Programming Perl</A
> | <A
HREF="../advprog/index.htm"
TITLE="Advanced Perl Programming"
>Advanced Perl Programming</A
> | <A
HREF="../cookbook/index.htm"
TITLE="Perl Cookbook"
>Perl Cookbook</A
> ]</FONT
></P
></DIV
></BODY
></HTML
>
